# TOLSTOVKA — Telegram Mini App (Next.js)

Этот проект — витрина магазина и админка внутри Telegram WebApp (Mini App).

Стек: Next.js 14 + TypeScript + Tailwind CSS. Данные на этапе MVP хранятся в памяти (для локальной разработки). Для продакшена на Vercel нужно подключить внешнее хранилище (см. ниже).

## Быстрый старт (локально)
1. Установите зависимости:
   - npm install
2. Создайте файл `.env.local`:
   - Скопируйте `.env.local.example` и заполните значения
3. Запустите dev-сервер:
   - npm run dev
4. Откройте http://localhost:3000

## Страницы
- `/` — Витрина: баннеры, категории, грид товаров, сортировка по цене.
- `/c/[slug]` — Витрина, открытая на конкретной категории (например: `/c/new-drop`, `/c/tshirts`). Ставьте такие ссылки в баннерах, чтобы вести на нужный раздел.
- `/about` — О нас.
- `/delivery` — Доставка.
- `/contacts` — Обратная связь.
- `/admin/login` — Вход в админку (логин/пароль).
- `/admin` — Админ: управление баннерами, категориями, товарами; обновление логина/пароля; выход.

## Функционал
- Баннеры: любое количество, кликабельные, ведут по URL.
- Каталог: категории; сортировка по цене (возр/убыв); карточки товара показывают цену, кнопка «Написать» открывает чат менеджеру.
- «Новый дроп» — отдельная категория (создана по умолчанию).
- Админка: быстрое добавление товара по картинке URL (по одной ссылке в строке), изменение цены, удаление (т.к. товар штучный).
- Авторизация админа: логин/пароль; в MVP — хранение сессии и данных в памяти (после перезапуска сбрасывается).

## Интеграция с Telegram
- Внутри Telegram WebApp SDK вызов `openTelegramLink()` открывает чат с менеджером `t.me/<username>` и подставляет шаблон сообщения: `Хочу купить: {категория}/{название} — {цена} — ID:{id}`. Задайте переменную окружения `NEXT_PUBLIC_TG_MANAGER_USERNAME`.
- В проект добавлен роут вебхука бота: `POST /api/tg`. Он обрабатывает `/start` и отправляет инлайн-клавиатуру с кнопкой WebApp.
- Переменные окружения:
  - `TELEGRAM_BOT_TOKEN` — токен бота (НЕ храните его в коде, задайте в Vercel env)
  - `NEXT_PUBLIC_WEBAPP_URL` — базовый URL мини‑приложения (например, https://your-app.vercel.app)
- Установка вебхука (после деплоя на Vercel):
  - Windows PowerShell:
    ```powershell path=null start=null
    $env:BOT_TOKEN="{{TELEGRAM_BOT_TOKEN}}"; $env:APP_URL="https://your-app.vercel.app";
    curl -Method Post -Uri "https://api.telegram.org/bot$env:BOT_TOKEN/setWebhook" -Body @{ url="$env:APP_URL/api/tg" }
    ```
  - Bash:
    ```bash path=null start=null
    BOT_TOKEN={{TELEGRAM_BOT_TOKEN}} APP_URL=https://your-app.vercel.app \
    curl -s -X POST https://api.telegram.org/bot$BOT_TOKEN/setWebhook -d url=$APP_URL/api/tg
    ```
- Команда `/start` в боте покажет кнопки: «Смотреть товар» (WebApp), «Новый дроп», «О нас», «Доставка», «Обратная связь».

## Рекомендации по баннерам
- Соотношение сторон: 2.5:1 (например, 1200×480).
- Форматы: JPG/PNG/WebP, вес до ~500KB.
- Вёрстка использует `aspect-ratio` и `object-fit: cover`. На мобильных блок скроллится по горизонтали с snap-эффектом.

## Брендирование
- Цвета из ТЗ:
  - Фон: `#ffc81a`
  - Текст/акцент: `#383b3d`
  - Дополнительный: белый `#ffffff`
- Шрифт: сейчас системный. Заменить просто — подключите необходимый OTF/TTF в `app/layout.tsx` или через CSS и Tailwind (`fontFamily`).

## Важно о данных на Vercel
Сейчас данные и сессии админа хранятся в памяти процесса. На Vercel это ненадёжно (функции без состояния). Для продакшена подключите одно из:
- Vercel Postgres / Supabase (Postgres) — для хранения категорий, товаров, баннеров, учётки админа.
- Vercel KV / Upstash Redis — как быстрый кэш/хранилище.
- Vercel Blob / S3-совместимое хранилище — для файлов, если перейдёте с URL на загрузку в облако.

Я подготовлю интерфейсы хранилища, чтобы легко заменить in-memory реализацию на Postgres.

## Деплой на Vercel
1. Создайте репозиторий на GitHub и запушьте проект
2. Подключите репозиторий в Vercel
3. В разделе Environment Variables задайте `NEXT_PUBLIC_TG_MANAGER_USERNAME`, `ADMIN_USER`, `ADMIN_PASS`
4. Деплой произойдёт автоматически при пуше в main

## Следующие шаги
- Подключить постоянную БД (Vercel Postgres) и перенести CRUD.
- Добавить бот-код с /start и WebApp-кнопкой (webhook на Vercel API или отдельный хост).
- Расширить карточку товара (размеры/состояние) — опционально.